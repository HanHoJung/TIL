# Chapter04 액세스 회선을 통해 인터넷 내부로

[TOC]

## STORY 01 ASDL 기술을 이용한 액세스 회선의 구조와 동작

> 가정·회사 LAN과 인터넷

가정·회사 LAN과 인터넷은 규모의 차이가 있지만, 공통적으로 라우터를 거쳐서 원하는 도착지점으로 패킷을 전송하는데 있습니다.

그러나  다음과 같은 차이점이 있습니다.

- **거리의 차**

  가정이나 회사의 LAN의 경우, 중계 장치간의  거리가 수백미터 정도 되지만 인터넷의 중계장치의 거리는 수 킬로미터가 넘습니다. 예를들어 대한민국과 미국을 연결한다면 단순히 이더넷 케이블로 연결하기 어렵습니다.

  

- **경로정보의 등록방법의 차이**

  기본적으로, 경로 정보에 기초하여 목적지에 패킷을 보내는 것의 같으나, 경로표에 정보를 등록하는 부분이 다릅니다.



> 액세스 회선

이 챕터에서 설명할 상황은 다음과 같습니다.

Client=>스위칭 허브=>이더넷 라우터=>인터넷=>목적지 서버

인터넷 라우터에 접속할 때 라우터의 패킷 송신 동작은 이더넷의 패킷 송신 동작과는 다른 부분이 있습니다.



즉, 먼거리에 대하여 정보를 전송해야 하기 때문에, 인터넷 접속용 라우터는 액세스 회선을 사용합니다.

액세스 회선은, 가정·회사의 LAN과 인터넷을 연결해주는 통신 회선을 의미합니다. 따라서, 액세스 회선 규칙을 따라야 합니다.

- 가정:ADSL, FTTH,CATV,전화회선, ISDN 등 (액세스 회선 종류)
- 회사:전용회선(액세스 회선 종류)



> ASDL

1. **사용자측 PC에서 패킷을 전송**

2. **사용자측 라우터=>ASDL모뎀 또는 전화 케이블**

   인터넷 접속용 라우터는 패킷을 ASDL모뎀에 보낼 때

   MAC헤더, PPPoE 헤더, PPP 헤더 세 가지를 붙이고 ASDL 모뎀에 패킷을 전송합니다.

   (PPPOE 경우)

​     < 패킷의 모습>

​       MAC헤더, PPPoE 헤더, PPP 헤더,IP헤더,데이터

3. **ASDL모뎀**

   패킷을 작게 분할하여 셀에 저장하고 전기신호로 바꾸어 스플리터에 송신

4. **스플리터에서 DSLAM로 패킷 전송**

   전화국에서는 다수의 사용자로부터 패킷을 전송받기 때문에 여러개의 ASDL 모뎀이 필요합니다. 때문에 DSLAM을 사용합니다.

   DSLAM이란, 다수의 ASDL 모뎀에 해당하는 기능을 묶어서 하나의 케이스에 넣은 장치 입니다.

   전기신호->셀

5. **DSLAM에서 BAS(광대역 액세스 서버)로 전송**

   - BAS는 ATM셀을 2번에서 보낸 형태의 모습으로 변환(즉, PPPoE헤더,MAC헤더 버림)

     PPoE,MAC헤더는 이전 단계에서 BAS로 도착할 때 사용되었으므로 현재 필요 없음

   - 터널링용 헤더를 붙여 터널링용 라우터에 패킷 송신(L2TP터널링 경우)

6. **BAS(광대역 액세스 서버)에서 터널링용 라우터 도착**

   - 터널링용 라우터는 터널리용 헤더를 분리하고 IP패킷 추출
   - 인터넷 라우터에 패킷을 중계



cf)

BAS

- Broadband Access Server. 라우터의 일종



PPP

- Point-to-Point protocol
- 전화회선이나 ISDN 등의 통신회선을 사용하여 통신할 때 사용하는 구조
- 본인 확인, 설정값 통지, 데이터 압축, 암호화 등 다양한 기능 사용 가능

   



> FTTH

- 광섬유를 사용한다.
- ADSL 대신 광섬유를 사용하여 사용자측의 인터넷 접속용 라우터와 BAS를 접속하는 것이 FTTH 액세스 회선 입니다.





## STORY 02 액세스 회선으로 이용하는 PPP와 터널링

> 본인 확인과 설정 정보를 통지

사용자측에서 ADSL 또는 FTTH등의 액세스 회선을 통해 패킷이 전송되고 이를 액세스 회선을 운영하는 사업자가 소유한 BAS에 도착합니다.



BAS는 액세스 회선을 연결하는 라우터 입니다.

**BAS의 역할**

- 본인 확인과 설정값 통지 기능

  - ADSL이나 FTTH의 액세스 회선은 최초의 사용자명과 패스워드를 입력하여 로그인 동작을 실행하지 않으면 인터넷에 액세스할 수 없습니다. BAS는 로그인 창구 역할

  - BAS는 PPPoE 구조를 사용함(사업자마다 PPPoA 구조를 사용하는 사업자도 있음)

    - PPP 메시지를 운반할 때 이더넷의 프리앰블이나 FCS 규정이 존재하지 않아서 이를 위해 HDLC라는 프로토콜을 적용합니다. 따라서 PPP 메시지를 전송할 때에는 HDLC 헤더가 붙게 됩니다.

      (다이얼업 PPP에서)

      - ASDL과 FTTH는 HDLC 대신 PPPoE 헤더를 붙여 전송합니다.

    

- 터널링 기능

  - 터널링을통해서도 패킷을 전송할 수 있다.

  - BAS와 프로바이더의 라우터 사이에 있는 ADSL또는FTTH 접속 서비스 사업자의 네트워크 안에 터널을

    만드는 방식

    - 첫 번째 방식(TCP 커넥션을 이용한 터널링)
      - 터널링용 라우터 간의 TCP 커넥션을 만듭니다.
      - 소켓에 해당하는 부분이 라우터의 포트 입니다.
      - 소켓을 통해 데이터가 전손됩니다.
    - 두 번째방식(캡슐화를 이용한 터널링)
      - 패킷에 별도의 헤더를 부가하여 데이터를 보내는 방식 입니다.

    

   


cf)

PPP

- 전화 회선이나 ISDN을 사용하여 인터넷에 다이얼업 방식으로 접속할 때 PPP 동작 방식
- PPPoE는 PPP에서 발전된 모델



PPPoE

- 전화회선을 이용한 다이얼업 접속으로 이용하는 PPP라는 구조를 발전시킨것



> 액세스 회선 전체 동작

1.1 접속명령

- 사용자측, 인터넷 접속용 라우터에  프로바이더가 할당한 사용자명과 패스워드를 등록 합니다.

1.2 회선 접속

- 사용자측, 인터넷 접속용 라우터는 PPPoE의 Discovery라는 구조에 따라 BAS를 찾습니다.

  - ex)

    ​     브로드캐스트 구조 사용(모든 node에게 BAS에 MAC주소 요청)

2.1~2.4 본인확인 및 설정값 통지

- 패스워드 암호 방식(CHAP 또는 PAP) 설정

- BAS에서 보낸 TCP/IP 설정값은 인터넷 접속용 라우터의 BAS측 포트에 설정됨

  =>인터넷 접속 준비

3 . 인터넷 핵심부로 데이터 패킷이 송・수신

- 패킷을 보낼때 PPPoE헤더,PPP헤더 를 부과해서 보냄

- BAS는 인터넷 접속용 라우테에서 보내온 패킷을 받아 MAC 헤더와 PPPoE헤더를 제거한 후 터럴링 원리를

  사용하여 ㅍ로바이더의 라우터를 향해 송신



> PPPoE이외의 방식

- PPPoE 방식 이외에 PPPoA라는 방식이 있습니다. 이 방식은 MAC 헤더와 PPPoE 헤더를 붙이지 않고 패킷을 전송하는 특징이 있습니다.



cf)

PPP를 사용하지 않고 이더넷의 패킷을 그대로 ADSL 신호로 변환하여 DSLAM에 송신하는 DHCP 방식도 있습니다.

- 주로 DHCP는 사내 LAN에서 클라이언트 pc에 TCP/IP의 설정 정보를 통지하기 위해서 널리 사용된다.

- 사용자명과 패스워드 확인 필요없음

- PPP의 추가적인 헤더가 붙어 있지 않아 MTU가 짧아지지 않는 장점이 있다.

  



## STORY 03 프로바이더의 내부

> POP와 NOC

인터넷의 실체는 다수의 프로바이더의 네트워크를 서로 연결한것 입니다.

**POP**

- ADSL/FTTH의 액세스 회선은 사용자가 계약한 프로바이더 설비에 연결되어 있습니다. 이 설비를  POP라 부릅니다.

- POP(Point Of Presence)

- POP의 구성은, 액세스 회선 수와 프로바이더의 사업 형태에 따라 다르지만 아래 그림과 같습니다.

  액세스 회선에 따라 다양한 종류의 라우터를 사용합니다.

  <전용선을 사용한 경우>

  - 통신 회선용 포트를 장착한 보통의 라우터 사용

  - 전용선은 본인 확인이나 설정 값 통지 등의 기능이 필요 없음 그 이유는 회선을 고정적으로 접속하기 때문에 본인 확인이 필요하지 않습니다.

    

  <전화회선/ISDN 회선>

  - RAS라는 라우터 사용
  - 전화회선/ISDN 같은 회선은 사용자로부터 걸려온 전화를 받는 기SMD이 필요하기 때문에 RAS에  이 기능이 내장되어 있음

  

  <ASDL/FTTH회선>

  - 둘 다 공통적으로 BAS 사용

  - PPPoE 사용 또는 PPPoA 사용함

  ![](./img/provider.PNG)

  

**NOC**

- Network Operation Center
- POP에서 들어오는 패킷은 모두 NOC에 전송된다. 또한 NOC끼리 연결해준다.
- 일종의 고성능 라우터를 의미한다.
- NOC와 POP는 엄격히 구분할 필요도 없다. NOC도 액세스 회선을 연결한 라우터를 설치하고 POP 처럼 사용하는 경우도 있기 때문입니다. 따라서 POP에서 규모가 커진것이라고 생각하면 됩니다.

![](./img/provider1.PNG)

cf)

회사나 가정의 LAN은 트위스트 페어 케이블을 이용하여 기기를 접속합니다. 그러나 프로바이더의 네트워크는 흐르는 패킷의 양이 많이 때문에 광섬유 케이블을 사용합니다.  따라서 광섬유 케이블 통해 NOC나 POP를 연결합니다. 그러나 광섬유를 직접 연결하는 것은 막대한 비용과 유지보수가 어렵기 때문에 극소수의 대형 프로바이더에 한정 됩니다. 보통 이러한 경우는, 자사(통신사, 전력회사, 전화회사)에서 광섬유를 소유하여 먼 거리의 NOC나 POP에 연결하게 됩니다. 

광섬유를 소유한 소수의 프로바이더는 광섬유를 대여하는 사업을 진행합니다. 광섬유를 내부적으로 세부적으로 나누어 대여하는 형식으로 진행됩니다. 따라서 그 밖에 프로바이더(광섬유를 소유하지 못한)는 이러한 대여를 통하여 NOC와 POP를 연결하는 서비스를 진행합니다.





## STORY 04 프로바이더를 경유하여 흐르는 패킷

> 프로바이더끼리 경로정보 교환하기

프로바이더의 라우터끼리 라우팅 테이블 통하여 다음 라우터를 판단합니다. 이러한 절차를 반복하게 되면 원하는 목적지에 패킷이 전송됩니다.

경로정보 등록은 다음과 같은 절차로 진행됩니다.

- 상대 라우터가 경로정보를 알려주면 그것을 라우팅 테이블에 기록한다. 또한, 반대로 내가 속한 라우터에서도 경로정보를 상대방에 알려줍니다.
- 이러한 경로 정보 교환은 BGP(Border Gateway Protocol)을 사용하여 라우터가 자동적으로 수행 합니다.

![](./img/provider2.PNG)

- BGP

  - 방식1. 인터넷의 경로를 전부 상대에게 통지하는 것

    ```
    프로바이더D가 프로바이더 E에게 인터넷의 경로를 전부 상대에게 통지
    프로바이더D는(프로바이더 A,B,C 등에 대한 경로 정보를 모두 가지고 있습니다.)
    따라서, 이를 전달받은 프로바이더 E는 A,B,C 그 외에 기기의 경로에 대해 알 수 있습니다.
    또한, 프로바이더 A,B,C등은 프로바이더 D를 통가하여 패킷이 E에 전송됩니다. D에 해당하는 프로바이더를 트랜지트(transit)라 부릅니다.
    ```

  - 방식2. 비트랜지트 또는 피어(peer)

    ```
    두 프로바이더 각각의 네트워크에 관한 경로정보만 통지하는 방식으로서 서로 상대의 네트워크로 갈 패킷만 흐르게 됩니다. 
    
    cf)
    BGP의 구조에서 정보를 교환하는 상대를 피어(peer)라고 부름
    peer는 트랜지트와 비트랜지트를 모두 포함 여기서 말하는 peer는 비트랜지트를 의미함
    ```

    

![](./img/provider3.PNG)

cf)

이더넷 내부에서는 BGP 라는 구조를 사용하여 프로바이더 간에 경로 정보를 교환 합니다.



>  사내 네트워크에서 자동 등록하기

사내 네트워크와 프로바이더끼리 경로를 교환하는 방식이 차이가 있습니다.

< 사내 네트워크>

- 목적지까지 최단 경로를 찾아 거기에 패킷을 중계하는 방식을 사용 합니다. 이러한 방식 때문에 주변에 있는 전체 라우터와 무차별적으로 경로 정보를 교환 합니다.

  

<프로바이더>

- 프로바이더의 경유 사내 네트워크 방식의 경로교환 방식은 문제가 될 수 있습니다. 

- 예를 들어, A 프로바이더 한국에서 일본까지 고속 통신 회선을 가지고 있는 상황 입니다. 

  미국에 액세스할 때 이 고속통신회선이 최단 경로가 될 가능성이 있습니다. 이러한 상황에서 단순히 최단경로를 찾아 패킷을 사용하다 보면 다른 프로바이더 사업자에서 보낸 패킷이 이 고속 통신 회선에 유입될 수 있습니다. 다른 사업자가 사용료를 내면 상관없지만 그렇지 않는경우 무임승차하는결과가 발생 합니다. 따라서 프로바이더의 경유 단순히 최단 경로를 선택하지 않고 **의도하지 않는 상대로부터 오는 패킷을 중지하는 구조가 필요합니다.** 따라서 다음과 같은 절차를 진행 합니다.

  1. 프로바이더의 간의 경로 정보 교환은 1대1로 이루어 집니다.(허가된 사용된 패킷을 보낼 수 있음)

     허가된 사용자의 패킷만 외부로 보냄

  2. 더불어, 경로를 판단할 때 최단경로인지 판단해서 패킷을 전송 합니다.

     

> IX 의 필요성

![](./img/provider3.PNG)



그림과 같이 프로바이더 C와D를 1대 1로 접속하는 것이 기본적인 방법 입니다. 그러나 이러한 방식은 모든 프로바이더와 1:1로 통신 회선을 연결하는 단점이 있습니다. 이를 해결하는 설비가 바로 IX(Internet eXchange)입니다. 이를 통하여 통신회선 수를 억제할 수 있습니다.

![](./img/provider4.PNG)